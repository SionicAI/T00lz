<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zen Task Manager</title>
  <style>
    /* Estilos generales */
    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background-color: #f5f5f5;
      color: #333;
      margin: 0;
      padding: 20px;
      line-height: 1.6;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    body.dark-mode {
      background-color: #1a1a1a;
      color: #f5f5f5;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }

    body.dark-mode .container {
      background: #2d2d2d;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    h1 {
      font-size: 24px;
      font-weight: 300;
      margin-bottom: 20px;
      text-align: center;
    }

    /* Botón de modo oscuro */
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: background-color 0.3s ease;
    }

    .theme-toggle:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .theme-toggle:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .theme-toggle svg {
      width: 24px;
      height: 24px;
      fill: #333;
      transition: fill 0.3s ease;
    }

    body.dark-mode .theme-toggle svg {
      fill: #f5f5f5;
    }

    /* Selector de grupo de tareas */
    .group-selector {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .group-selector select {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 12px;
      font-size: 14px;
      background: #fff;
      color: #333;
      transition: border-color 0.3s ease, background-color 0.3s ease, color 0.3s ease;
    }

    body.dark-mode .group-selector select {
      background: #3d3d3d;
      border-color: #555;
      color: #f5f5f5;
    }

    .group-selector button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: background-color 0.3s ease;
    }

    .group-selector button:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .group-selector button:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .group-selector button svg {
      width: 18px;
      height: 18px;
      fill: #333;
      transition: fill 0.3s ease;
    }

    body.dark-mode .group-selector button svg {
      fill: #f5f5f5;
    }

    /* Gestión de tareas */
    .task-input {
      width: 90%;
      padding: 12px 16px;
      border: 1px solid #ddd;
      border-radius: 12px;
      font-size: 14px;
      margin-bottom: 20px;
      background: #fff;
      color: #333;
      transition: border-color 0.3s ease, background-color 0.3s ease, color 0.3s ease;
    }

    body.dark-mode .task-input {
      background: #3d3d3d;
      border-color: #555;
      color: #f5f5f5;
    }

    .task-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .task-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      border-bottom: 1px solid #eee;
      transition: border-color 0.3s ease, background-color 0.3s ease;
    }

    body.dark-mode .task-item {
      border-color: #444;
    }

    .task-item:last-child {
      border-bottom: none;
    }

    .task-item input[type="checkbox"] {
      appearance: none;
      width: 18px;
      height: 18px;
      border: 2px solid #ddd;
      border-radius: 50%;
      margin-right: 10px;
      cursor: pointer;
      transition: border-color 0.3s ease, background-color 0.3s ease;
    }

    .task-item input[type="checkbox"]:checked {
      background-color: #333;
      border-color: #333;
    }

    body.dark-mode .task-item input[type="checkbox"] {
      border-color: #555;
    }

    body.dark-mode .task-item input[type="checkbox"]:checked {
      background-color: #f5f5f5;
      border-color: #f5f5f5;
    }

    .task-item span {
      flex: 1;
      cursor: pointer;
      word-break: break-word;
      transition: color 0.3s ease;
    }

    .task-item input[type="text"] {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      background: #fff;
      color: #333;
      transition: border-color 0.3s ease, background-color 0.3s ease, color 0.3s ease;
    }

    body.dark-mode .task-item input[type="text"] {
      background: #3d3d3d;
      border-color: #555;
      color: #f5f5f5;
    }

    .task-item button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: background-color 0.3s ease;
    }

    .task-item button:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .task-item button:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .task-item button svg {
      width: 18px;
      height: 18px;
      fill: #999;
      transition: fill 0.3s ease;
    }

    .task-item button:hover svg {
      fill: #333;
    }

    body.dark-mode .task-item button:hover svg {
      fill: #ccc;
    }

    /* Tareas completadas */
    .completed-tasks {
      margin-top: 20px;
    }

    .completed-tasks-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      padding: 12px;
      background: #f9f9f9;
      border-radius: 12px;
      transition: background-color 0.3s ease;
    }

    body.dark-mode .completed-tasks-header {
      background: #3d3d3d;
    }

    .completed-tasks-header h2 {
      font-size: 16px;
      font-weight: 400;
      margin: 0;
    }

    .completed-tasks-header button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: background-color 0.3s ease;
    }

    .completed-tasks-header button:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .completed-tasks-header button:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .completed-tasks-header button svg {
      width: 18px;
      height: 18px;
      fill: #999;
      transition: fill 0.3s ease;
    }

    .completed-tasks-header button:hover svg {
      fill: #333;
    }

    body.dark-mode .completed-tasks-header button:hover svg {
      fill: #ccc;
    }

    .completed-tasks-list {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }

    .completed-tasks-list.visible {
      max-height: 500px;
    }

    /* Responsividad */
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }

      .container {
        padding: 15px;
      }

      .theme-toggle {
        top: 10px;
        right: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Zen Task Manager</h1>

    <!-- Botón de modo oscuro con SVG -->
    <button class="theme-toggle" onclick="toggleDarkMode()">
      <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="5" />
        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
      </svg>
      <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="display: none;">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
      </svg>
    </button>

    <!-- Selector de grupo de tareas -->
    <div class="group-selector">
      <select id="group-select">
        <option value="default">Tareas Generales</option>
      </select>
      <button id="add-group">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
        </svg>
      </button>
      <button id="edit-group">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
        </svg>
      </button>
    </div>

    <!-- Creación de tareas -->
    <input type="text" id="task-input" class="task-input" placeholder="Añadir una nueva tarea y presiona Enter">

    <!-- Lista de tareas -->
    <ul id="task-list" class="task-list"></ul>

    <!-- Tareas completadas -->
    <div class="completed-tasks">
      <div class="completed-tasks-header" onclick="toggleCompletedTasks()">
        <h2>Tareas Completadas</h2>
        <button id="clear-completed">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
          </svg>
        </button>
      </div>
      <ul id="completed-tasks-list" class="completed-tasks-list"></ul>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script>
    // Variables globales
    let currentGroup = "default";
    let tasks = JSON.parse(localStorage.getItem("tasks")) || { default: [] };
    let darkMode = localStorage.getItem("darkMode") === "true";

    // Elementos del DOM
    const body = document.body;
    const sunIcon = document.getElementById("sun-icon");
    const moonIcon = document.getElementById("moon-icon");
    const groupSelect = document.getElementById("group-select");
    const addGroupButton = document.getElementById("add-group");
    const editGroupButton = document.getElementById("edit-group");
    const taskInput = document.getElementById("task-input");
    const taskList = document.getElementById("task-list");
    const completedTasksList = document.getElementById("completed-tasks-list");
    const clearCompletedButton = document.getElementById("clear-completed");

    // Inicializar modo oscuro
    if (darkMode) {
      body.classList.add("dark-mode");
      sunIcon.style.display = "none";
      moonIcon.style.display = "block";
    } else {
      sunIcon.style.display = "block";
      moonIcon.style.display = "none";
    }

    // Cargar tareas al iniciar
    loadTasks();

    // Eventos
    groupSelect.addEventListener("change", () => {
      currentGroup = groupSelect.value;
      loadTasks();
    });

    addGroupButton.addEventListener("click", addGroup);
    editGroupButton.addEventListener("click", editGroup);
    taskInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter" && taskInput.value.trim()) {
        addTask(taskInput.value.trim());
        taskInput.value = "";
      }
    });
    clearCompletedButton.addEventListener("click", clearCompletedTasks);

    // Funciones
    function loadTasks() {
      taskList.innerHTML = "";
      completedTasksList.innerHTML = "";
      tasks[currentGroup].forEach((task, index) => {
        if (task.completed) {
          renderCompletedTask(task, index);
        } else {
          renderTask(task, index);
        }
      });
      initSortable();
    }

    function renderTask(task, index) {
  const li = document.createElement("li");
  li.className = "task-item";
  li.setAttribute("data-index", index); // Agregar atributo data-index
  li.innerHTML = `
    <input type="checkbox" onchange="toggleTaskCompletion(${index})">
    <span onclick="editTask(${index})">${task.text}</span>
    <button onclick="deleteTask(${index})">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
      </svg>
    </button>
  `;
  taskList.appendChild(li);
}

function renderCompletedTask(task, index) {
  const li = document.createElement("li");
  li.className = "task-item";
  li.setAttribute("data-index", index); // Agregar atributo data-index
  li.innerHTML = `
    <input type="checkbox" checked onchange="toggleTaskCompletion(${index})">
    <span onclick="editTask(${index})">${task.text}</span>
    <button onclick="deleteTask(${index})">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
      </svg>
    </button>
  `;
  completedTasksList.appendChild(li);
}

    function addTask(text) {
      tasks[currentGroup].push({ text, completed: false });
      saveTasks();
      loadTasks();
    }

    function toggleTaskCompletion(index) {
      tasks[currentGroup][index].completed = !tasks[currentGroup][index].completed;
      saveTasks();
      loadTasks();
    }

    function editTask(index) {
  const task = tasks[currentGroup][index];

  // Buscar el <li> correcto usando el atributo data-index
  const li = document.querySelector(`.task-item[data-index="${index}"]`);

  if (!li) {
    console.error("No se encontró la tarea para editar.");
    return;
  }

  const span = li.querySelector("span");
  const input = document.createElement("input");
  input.type = "text";
  input.value = task.text;
  li.replaceChild(input, span);
  input.focus();

  // Guardar la edición al desenfocar
  input.addEventListener("blur", () => saveTaskEdit(index, input.value));

  // Guardar la edición al presionar "Enter"
  input.addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
      saveTaskEdit(index, input.value);
    }
  });
}

    function saveTaskEdit(index, newText) {
      tasks[currentGroup][index].text = newText.trim();
      saveTasks();
      loadTasks();
    }

    function deleteTask(index) {
      tasks[currentGroup].splice(index, 1);
      saveTasks();
      loadTasks();
    }

    function clearCompletedTasks() {
      tasks[currentGroup] = tasks[currentGroup].filter((task) => !task.completed);
      saveTasks();
      loadTasks();
    }

    function addGroup() {
      const groupName = prompt("Nombre del nuevo grupo:");
      if (groupName && !tasks[groupName]) {
        tasks[groupName] = [];
        groupSelect.innerHTML += `<option value="${groupName}">${groupName}</option>`;
        saveTasks();
      }
    }

    function editGroup() {
      const newName = prompt("Nuevo nombre del grupo:", currentGroup);
      if (newName && newName !== currentGroup) {
        tasks[newName] = tasks[currentGroup];
        delete tasks[currentGroup];
        groupSelect.querySelector(`option[value="${currentGroup}"]`).value = newName;
        groupSelect.querySelector(`option[value="${newName}"]`).textContent = newName;
        currentGroup = newName;
        saveTasks();
      }
    }

    function saveTasks() {
      localStorage.setItem("tasks", JSON.stringify(tasks));
    }

    function toggleDarkMode() {
      body.classList.toggle("dark-mode");
      darkMode = body.classList.contains("dark-mode");
      localStorage.setItem("darkMode", darkMode);
      sunIcon.style.display = darkMode ? "none" : "block";
      moonIcon.style.display = darkMode ? "block" : "none";
    }

    function toggleCompletedTasks() {
      completedTasksList.classList.toggle("visible");
    }

    function initSortable() {
      new Sortable(taskList, {
        animation: 150,
        onEnd: (evt) => {
          const task = tasks[currentGroup].splice(evt.oldIndex, 1)[0];
          tasks[currentGroup].splice(evt.newIndex, 0, task);
          saveTasks();
        },
      });
    }
  </script>
</body>
</html>
